# DevOps-Project

```
–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –î–ò–ü–õ–û–ú–ù–û–ú–£ –ü–†–û–ï–ö–¢–£

–í –¥–∏–ø–ª–æ–º–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
‚Ä¢ –≤—ã–±—Ä–∞–Ω –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–æ—Å—Ç–æ—è—â–µ–≥–æ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤;
‚Ä¢ –≤—ã–ø–æ–ª–Ω–µ–Ω fork –∏–ª–∏ —Å–¥–µ–ª–∞–Ω–∞ –∫–æ–ø–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è;
‚Ä¢ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞;
‚Ä¢ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã CI/CD;
‚Ä¢ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
‚Ä¢ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –æ–ø–∏—Å—ã–≤–∞—é—â—É—é —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–±–æ—Ä–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è;
‚Ä¢ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è —Å –Ω—É–ª—è –∑–∞–ø—É—Å–∫–æ–º –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã. –í—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º IaC;
‚Ä¢ CI/CD:
    o –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ –ª—é–±—É—é –≤–µ—Ç–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —ç—Ç–∞–ø—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º, —Å–±–æ—Ä–∫–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞, –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ;
    o –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É (master/main) –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π deployment –Ω–∞ —Ü–µ–ª–µ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É;
    o –î–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–±–æ—Ä–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ –ª—é–±–æ–π –∫–∞–Ω–∞–ª (–ø–æ—á—Ç–∞, —á–∞—Ç).

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ) –≤–∞—Ä–∏–∞–Ω—Ç—ã —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:
‚Ä¢ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è SSL/TLS;
‚Ä¢ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–º);
‚Ä¢ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è;
‚Ä¢ Kubernetes –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ü–µ–ª–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã;
‚Ä¢ –ë–æ–ª—å—à–µ —Ç–∏–ø–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ, –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ –∏ –ø—Ä.);
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ–≥–æ (–≤–∫–ª—é—á–∞—è CI\CD, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥) —Å –Ω—É–ª—è;
‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
‚Ä¢ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Log-aggregation;
‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥.

–ü—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
‚Ä¢ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã: Terraform, AWS, EKS, Ansible, Docker, Vagrant;
‚Ä¢ CI/CD: Jenkins, Github Actions;
‚Ä¢ –û–ø–æ–≤–µ—â–µ–Ω–∏–µ: Email, Telegram, Slack, Discord;
‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Prometheus, Grafana;
‚Ä¢ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: ELK.

–ó–∞—â–∏—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞:
‚Ä¢ –ö—Ä–∞—Ç–∫–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞, –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (3-5 –º–∏–Ω.);
‚Ä¢ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è CI/CD (10-12 –º–∏–Ω.);
‚Ä¢ –í–æ–ø—Ä–æ—Å—ã –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ (5-7 –º–∏–Ω.).

–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:
‚Ä¢ Golang Hello World
https://github.com/hackersandslackers/golang-helloworld
‚Ä¢ Sample app maven
https://github.com/jenkins-docs/simple-java-maven-app
‚Ä¢ Sample app gradle
https://github.com/jitpack/gradle-simple
https://github.com/jhipster/jhipster-sample-app-gradle
‚Ä¢ Calculator App
https://github.com/HouariZegai/Calculator
```

```
–î–∞—Ç–∞ –≤—ã–ø—É—Å–∫–Ω–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è (–∑–∞—â–∏—Ç–∞ –¥–∏–ø–ª–æ–º–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ 26.12.2022 (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫) –≤ 18.30 –æ–Ω–ª–∞–π–Ω.

–ü—Ä–æ–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–¥–∞–Ω—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é –∑–∞—Ä–∞–Ω–µ–µ‚ùóÔ∏è‚ùóÔ∏è

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤—ã–¥–∞—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è) –∏ —É—Å–ø–µ—à–Ω–æ–π –µ–≥–æ –∑–∞—â–∏—Ç–µ‚ÄºÔ∏è
–í—ã–ø—É—Å–∫–Ω–∏–∫–∞–º –æ–Ω–ª–∞–π–Ω —Ñ–æ—Ä–º—ã –æ–±—É—á–µ–Ω–∏—è, –≤—ã–¥–∞–µ—Ç—Å—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç‚ùóÔ∏è‚ùóÔ∏è

–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≤—ã–ø—É—Å–∫–Ω–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è (–Ω–∞ –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è 10 –º–∏–Ω—É—Ç (–≥—Ä—É–ø–ø–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç 15-20 –º–∏–Ω—É—Ç)) :
1. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
1.1 –°—Ç—É–¥–µ–Ω—Ç (–≥—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è "–ú–µ–Ω—è(–Ω–∞—Å) –∑–æ–≤—É—Ç ****"
1.2 –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Å–∞–º–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.
1.3 –ó–∞ –≤—Ä–µ–º—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –¥–∏–ø–ª–æ–º–∞ —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å —Ç–∞–∫–∏–º–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º–∏, –∫–∞–∫...
1.4 –ü–ª–∞–Ω–∏—Ä—É—é —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å ....
2. –°—Ç—É–¥–µ–Ω—Ç (–≥—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤) –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è/–æ–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫–æ–≤.
3. –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤üòä
```

## Example of creating ansible roles
```bash
cd files/for_ansible/roles/
ansible-galaxy init common
ansible-galaxy init install_docker
ansible-galaxy init install_java
ansible-galaxy init jenkins_user
ansible-galaxy init telegram_notification
```

## Initial steps for environment configuration

### 1) Edit `vagrant_config.yaml` in `files/for_vagrant/`:

```yaml
machines:
  HW_number: Final

  timezone: "Europe/Minsk"
  bridge_name: "en0: Wi-Fi"
  network_type: "public_network"

  ubuntu_prod:
    ip: "192.168.100.50"
    vagrant_name: "ubuntu_prod"
    box: "generic/ubuntu2004"
    hostname: "HW-{HW_number}-Ubuntu-Prod"
    mem: 512
    cpu: 1

...
...
...

ubuntu_test:
    ip: "192.168.100.51"
    vagrant_name: "ubuntu_test"
    box: "generic/ubuntu2004"
    hostname: "HW-{HW_number}-Ubuntu-Test"
    mem: 512
    cpu: 1
```
This `vagrant_config.yaml` used for creating ansible `inventory.yaml`

### 2) Make `full_init.sh` script executable:
```bash
chmod +x files/full_init.sh
```

### 3) Create two telegram bots:
   - For Ansible playbook 
   - For Jenkins pipeline
   
Example of creating telegram bot and get chat where to send messages:
```
1) Create new telegram bot in @BotFather.
   Get HTTP API bot token.
2) Create a new channel.
   Add a newly created bot with admin rights to it, it is necessary to publish new messages.
3) Get the chat ID to send notifications. 
   For this replace '<TOKEN>' as your HTTP API token. 
   Go to the https://api.telegram.org/bot<TOKEN>/getUpdates and get 'chat.id' value for channel
   (for channel chat, keep the sign '-' in front of the number, this is the full identifier)
```

### 4) Create Ansible Vault

- For success ansible telegram notification create two variables in ansible vault like `telegram_token` and `telegram_chat_id`
- For success running `localhost_playbook.yaml` add `ansible_become_password` with your sudo password for localhost machime

```bash
cd files/for_ansible/
```

To create encrypted Ansible Vault:
```bash
ansible-vault create vault.yml
```

To edit encrypted Ansible Vault:
```bash
ansible-vault edit vault.yml
```

In vault.yml add lines like:
```bash
telegram_token: "9999999:XXXXXXXXXXXXXXXXXXXXXXX"
telegram_chat_id: "1111111111111111"
ansible_become_password: "111111111"
```

---

### Ansible playbook with ansible vault example

To get variables from encrypted Ansible Vault:
```bash
--ask-vault-password --extra-vars '@vault.yml'
# or short form
--ask-vault-pass -e '@vault.yml'
```

Or use file with vault password for encrypted Ansible Vault
```bash
--vault-password-file vault -e '@vault.yml'
# or short form
--vault-pass-file vault -e '@vault.yml'
```

File `vault` contains password like: `123` for encrypted `vault.yml`

Example run ansible playbook with ansible vault
```bash
ansible-playbook -i inventory.yaml --vault-pass-file vault -e '@vault.yml' playbook.yaml
ansible-playbook -i inventory.yaml --vault-pass-file vault -e '@vault.yml' localhost_playbook.yaml
```

---

## Web application

This project uses a web application [Geometry calculator python flask web app](https://github.com/foxster14/geometry_calculator_python_flask_web_app.git) for docker build

Another web application example [Flask Web API](https://github.com/AiswaryaLakshmy/Flask-Web-API) for docker build

---

### Create (on localhost) SSH key for Jenkins master and GitHub
![](./images/create_jenkins_ssh_key.png)

### Add the newly created public SSH key to GitHub
![](./images/github_public_ssh_key.png)

### Add the newly created private SSH key to Jenkins master
![](./images/jenkins_master_private_ssh_key.png)

### Configure Jenkins agent for test environment
![](./images/agent_test.png)

### Configure Jenkins agent for production environment
![](./images/agent_prod.png)

### Create Jenkins pipeline for test environment
![](./images/jenkins_test_env_pipeline.png)

### Create Jenkins pipeline for production environment
![](./images/jenkins_prod_env_pipeline.png)
